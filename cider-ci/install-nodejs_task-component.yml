traits:
  'nvm-nodejs-version-manager': true
  Bash: true

scripts:
  install-nodejs:
    exclusive_executor_resource: nodejs-install_{{$NVM_NODEJS_VERSION}}
    timeout: 20 Minutes
    body: |
      #!/usr/bin/env bash
      set -eu

      source ~/.nvm/nvm.sh

      nvm install "$NVM_NODEJS_VERSION"
      nvm use "$NVM_NODEJS_VERSION"

      # NOTE: do NOT self-upgrade npm, instead use the version that is bundled with the nodejs release.
      #       because the upgrad is not transactional, no script using `npm` could run in paralell (e.g. all js build jobs would need the same `exclusive_executor_resource` as is used here)
      # # cleanup leftovers from aborted installs (or npm upgrade might fail)
      # rm -rf  "$NVM_DIR"/versions/node/*/lib/node_modules/.npm-*
      # npm i -g npm@7

      which node
      node --version

      which npm
      npm --version
